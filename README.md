# 快剪工具 (QuickCut)

## 项目概括
本项目旨在开发一个基于React + TypeScript的在线视频编辑工具，为普通消费者提供简单易用的视频剪辑体验。主要功能包括视频/图片/GIF上传、播放控制、视频片段截取、画面区域裁剪、候选管理和多格式导出。项目专注于操作简便性，支持移动端使用，满足用户快速剪辑分享的需求。

## 技术选型
- **主要编程语言**: TypeScript + React 18
- **关键库/框架**: 
  - React 18 (用户界面框架)
  - TypeScript (类型安全)
  - Zustand (轻量级状态管理)
  - Tailwind CSS + Headless UI (样式框架)
  - FFmpeg.wasm (视频处理)
  - Vite (构建工具)
- **视频处理**: FFmpeg.wasm (浏览器端视频处理)
- **数据存储**: LocalStorage (候选区本地缓存)
- **部署平台**: Vercel (自动CI/CD)
- **版本控制**: Git
- **其他工具**: ESLint + Prettier (代码规范), Vitest (测试)

## 项目结构 / 模块划分
```
/src/
  /components/           # React组件
    /ui/                # 通用UI组件 (按钮、输入框等)
    /layout/            # 布局组件
    /upload/            # 文件上传相关组件
    /player/            # 视频播放器组件
    /editor/            # 剪辑编辑相关组件
    /export/            # 导出下载组件
  /hooks/               # 自定义React Hooks
  /stores/              # Zustand状态管理
  /utils/               # 工具函数和辅助类
    /video.ts           # 视频处理工具
    /file.ts            # 文件处理工具
    /canvas.ts          # Canvas操作工具
  /types/               # TypeScript类型定义
  /constants/           # 常量定义
/public/                # 静态资源
/tests/                 # 测试文件
package.json            # 依赖管理
tsconfig.json           # TypeScript配置
tailwind.config.js      # Tailwind配置
vite.config.ts          # Vite构建配置
.gitignore              # Git忽略配置
```

## 核心功能 / 模块详解
- **媒体上传模块**: 支持视频、图片、GIF文件的拖拽和点击上传，包含格式验证、大小限制、进度显示和批量上传队列功能。
- **预览播放模块**: 提供视频播放控制，包括播放/暂停、时间轴拖拽、时间显示、音量控制，支持帧精确定位和移动端全屏播放。
- **剪辑编辑模块**: 实现时间段选择（双滑块时间轴）和区域裁剪（鼠标/触摸拖拽选择框），支持实时预览和预设比例快选。
- **候选管理模块**: 管理用户截取的视频片段，提供缩略图预览、删除操作、拖拽排序和本地缓存存储功能。
- **导出下载模块**: 支持MP4/GIF格式选择，提供高/中/低画质选项和自定义百分比，包含进度显示和错误处理机制。

## 数据模型
```typescript
// 媒体文件接口
interface MediaFile {
  id: string;
  name: string;
  type: 'video' | 'image' | 'gif';
  file: File;
  url: string;
  duration?: number; // 视频/GIF时长(秒)
  dimensions: { width: number; height: number };
}

// 剪辑片段接口
interface ClipSegment {
  id: string;
  mediaId: string;
  startTime: number;  // 开始时间(秒)
  endTime: number;    // 结束时间(秒)
  cropArea: {         // 裁剪区域
    x: number;
    y: number; 
    width: number;
    height: number;
  };
  thumbnail: string;  // 缩略图URL
  createdAt: Date;
}

// 导出设置接口
interface ExportSettings {
  format: 'mp4' | 'gif';
  quality: number;    // 画质百分比 (40-100)
  fps?: number;       // 帧率 (GIF导出)
}
```

## 技术实现细节

### 项目初始化 (已完成)
**架构设计**: 采用React 18 + TypeScript + Vite的现代前端技术栈，配合Tailwind CSS实现响应式设计。

**项目结构**: 按功能模块划分组件，采用"关注点分离"原则：
- `/components/upload/`: 文件上传相关组件
- `/components/player/`: 视频播放器组件  
- `/components/editor/`: 剪辑编辑工具组件
- `/components/export/`: 导出下载组件
- `/types/`: TypeScript类型定义，确保类型安全
- `/constants/`: 项目常量配置，便于维护

**核心配置文件**:
- `vite.config.ts`: 配置路径别名(@/)、开发服务器、构建优化
- `tailwind.config.js`: 自定义设计系统，包含主题色彩、动画配置
- `tsconfig.json`: TypeScript严格模式配置，确保代码质量

**UI设计系统**: 基于Tailwind CSS构建，包含自定义组件类如`.btn-primary`、`.card`、`.upload-zone`等，确保界面一致性。

### 媒体上传模块 (已完成)
**核心功能**: 实现了完整的拖拽和点击上传功能，支持多种媒体格式的验证和处理。

**技术实现**:
- `useFileUpload` Hook: 管理上传状态、进度跟踪和错误处理
- `file.ts` 工具模块: 文件验证、格式检查、媒体信息提取
- 拖拽上传: 支持拖拽文件到上传区域，实时视觉反馈
- 文件验证: 自动检查文件格式、大小限制，提供友好错误提示
- 进度显示: 实时上传和处理进度条，支持错误状态显示
- 媒体信息提取: 自动获取视频时长、图片/视频尺寸等元数据

**关键特性**:
- 支持 MP4, AVI, MOV, GIF, JPG, PNG 等多种格式
- 100MB 文件大小限制，10分钟视频时长限制
- 本地处理，无服务器上传，保护用户隐私
- 响应式设计，支持移动端拖拽操作
- 完善的错误处理和用户反馈机制

### 预览播放模块 (已完成)
**核心功能**: 实现了功能完整的视频播放器，支持视频、GIF播放和图片预览。

**技术实现**:
- `useVideoPlayer` Hook: 完整的播放状态管理，包含播放控制、进度跟踪、音量管理
- 响应式视频播放器: 自适应容器大小，保持原始宽高比
- 交互式进度条: 支持点击跳转和拖拽定位
- 音量控制: 悬停显示音量滑块，支持静音切换
- 键盘快捷键: 空格键播放/暂停，方向键控制进度和音量，M键静音
- 播放状态指示: 加载动画、播放按钮覆盖层、播放/暂停图标切换

**播放控制特性**:
- 播放/暂停控制
- 可拖拽进度条，精确到帧定位
- 音量调节（0-100%）和静音功能
- 实时时间显示（当前时间/总时长）
- 媒体信息展示（文件名、大小、尺寸、时长、格式）

**用户体验优化**:
- 悬停效果和过渡动画
- 图片、视频、GIF统一展示界面
- 移动端触摸操作支持
- 全面的键盘快捷键支持
- 加载状态和错误处理

### 剪辑编辑模块 (已完成)
**核心功能**: 实现了完整的视频剪辑功能，包括时间段选择和区域裁剪。

**技术实现**:
- `useVideoEditor` Hook: 管理编辑器状态，包含时间段选择、区域裁剪、预设比例管理
- `TimeRangeSlider` 组件: 双滑块时间轴，支持精确的时间段选择
- 区域裁剪: 在视频预览区域实现拖拽选择功能
- 预设比例: 支持自由选择、1:1、16:9、9:16、4:3、21:9等常用比例
- 候选管理: 完整的片段管理功能，包括添加、删除、预览
- 缩略图生成: 使用Canvas API从视频中生成裁剪后的缩略图

**时间段选择特性**:
- 双滑块交互: 独立控制开始和结束时间
- 精确定位: 0.1秒精度的时间选择
- 边界约束: 自动防止开始时间超过结束时间
- 视觉反馈: 实时进度条更新和时间显示
- 点击和拖拽: 支持点击跳转和拖拽调整

**区域裁剪特性**:
- 拖拽选择: 在视频预览区域直接拖拽选择裁剪范围
- 比例约束: 根据选择的预设比例自动调整裁剪框
- 实时预览: 显示裁剪区域尺寸和位置信息
- 边界检测: 防止裁剪框超出视频边界
- 视觉指示: 半透明选择框和拖拽锚点
- 视频内容显示: 在裁剪区域中显示实际的视频/图片内容

**候选管理功能**:
- 片段创建: 自动生成包含时间范围和裁剪信息的片段
- 智能缩略图: 自动生成裁剪后的视频缩略图预览
- 信息展示: 显示开始时间、结束时间、裁剪尺寸
- 删除操作: 单个删除和批量清空功能
- 状态管理: 实时更新候选区数量显示

**用户界面优化**:
- 标签式导航: 在编辑和候选区之间快速切换
- 响应式布局: 编辑器和播放器并排显示
- 操作提示: 详细的使用指南和状态反馈
- 错误处理: 完善的验证和错误提示机制

### 导出下载模块 (已完成)
**核心功能**: 实现了完整的视频处理和导出功能，包含真实的FFmpeg视频剪辑和多格式导出。

**技术实现**:
- `VideoProcessor` 类: FFmpeg.wasm封装，提供视频剪辑、裁剪、格式转换功能
- `ExportHandler` 类: 高级导出处理器，集成视频处理和文件下载功能
- `ExportPanel` 组件: 完整的导出设置界面，包含格式选择、画质配置、进度显示
- 格式支持: MP4视频格式和GIF动图格式
- 画质控制: 高/中/低预设画质和自定义画质滑块 (40%-100%)
- 导出选项: 单个片段导出和批量导出功能

**视频处理特性**:
- **FFmpeg.wasm集成**: 浏览器端视频处理，无需服务器支持
- **时间范围裁剪**: 精确到0.1秒的时间段截取
- **画面区域裁剪**: 支持任意矩形区域裁剪
- **多格式输出**: MP4 (H.264编码) 和 GIF (优化调色板) 
- **画质控制**: CRF质量控制和自定义压缩比例
- **音频处理**: MP4保持音频，AAC编码
- **缩略图生成**: 使用FFmpeg自动生成裁剪后的预览图

**导出功能**:
- 单个导出: 每个片段可单独导出，采用当前导出设置
- 批量导出: 一键导出所有候选片段，自动命名
- 进度显示: 实时导出进度条和详细状态提示
- 错误处理: 完善的错误处理和用户友好的错误信息
- 自动下载: 处理完成后自动下载到用户设备

**用户体验优化**:
- **进度反馈**: 初始化进度、处理进度、完成状态全程可视化
- **状态管理**: 导出时禁用相关操作，防止重复执行
- **错误恢复**: 导出失败后自动重置，允许重新尝试
- **文件命名**: 智能生成包含时长、画质、时间戳的文件名
- **内存管理**: 自动清理临时文件，防止内存泄漏

**当前状态**: 
- ✅ 导出UI界面完成
- ✅ 导出设置逻辑完成  
- ✅ 导出进度显示完成
- ✅ FFmpeg.wasm视频处理集成完成
- ✅ 文件下载功能完成
- ✅ 批量导出功能完成
- ✅ 错误处理和用户反馈完成

## 开发状态跟踪
| 模块/功能        | 状态     | 负责人 | 计划完成日期 | 实际完成日期 | 备注与链接 |
|------------------|----------|--------|--------------|--------------|------------------------------------|
| 项目初始化       | 已完成   | AI     | 2024-12-28   | 2024-12-28   | [架构设计](#项目初始化-已完成) |
| 媒体上传模块     | 已完成   | AI     | 2024-12-29   | 2024-12-28   | [上传功能](#媒体上传模块-已完成) |
| 预览播放模块     | 已完成   | AI     | 2024-12-30   | 2024-12-28   | [播放器功能](#预览播放模块-已完成) |
| 剪辑编辑模块     | 已完成   | AI     | 2024-12-31   | 2024-12-28   | [编辑功能](#剪辑编辑模块-已完成) |
| 候选管理模块     | 已完成   | AI     | 2025-01-02   | 2024-12-28   | [候选区管理](#剪辑编辑模块-已完成) |
| 导出下载模块     | 已完成   | AI     | 2025-01-03   | 2024-12-28   | [导出功能](#导出下载模块-已完成) |
| 移动端适配优化   | 未开始   | AI     | 2025-01-05   |              |                                    |
| 性能优化与测试   | 未开始   | AI     | 2025-01-06   |              |                                    |

## 代码检查与问题记录

**已解决问题**:
1. ✅ 画面裁剪区域显示问题 - 修改为显示实际视频/图片内容而非背景图
2. ✅ 候选区缩略图生成问题 - 实现了视频缩略图自动生成功能
3. ✅ 导出功能缺失问题 - 完成了导出界面和基础逻辑框架
4. ✅ 时间滑块与视频预览同步问题 - 拖动滑块时实时显示对应的视频帧
5. ✅ 真实的视频处理和导出功能 - 完成FFmpeg.wasm集成，实现完整的视频剪辑和导出

**待解决问题**:
1. 🔄 移动端触摸交互优化
2. 🔄 大文件处理性能优化

## 环境设置与运行指南
```bash
# 1. 安装依赖
npm install

# 2. 启动开发服务器
npm run dev

# 3. 构建生产版本
npm run build

# 4. 预览生产构建
npm run preview

# 5. 运行测试
npm run test

# 6. 代码格式检查
npm run lint
```

## 浏览器兼容性
- Chrome 88+ (推荐)
- Firefox 90+
- Safari 14+
- Edge 88+
- 移动端: iOS Safari 14+, Android Chrome 88+

## 性能考虑
- 文件大小限制: 100MB
- 支持的视频时长: 最长10分钟
- 内存管理: 自动释放处理完成的视频buffer
- 并发处理: Web Workers避免UI阻塞

## 部署说明
项目配置为在Vercel平台自动部署，支持GitHub集成的CI/CD流程。
